<!DOCTYPE html>
<html>

<head>
    <title>Web Bluetooth tool</title>
    <link rel="stylesheet" type="text/css" href="./libraries/css/tableCss.css">
    <!-- <link rel="stylesheet" type="text/css" href="./libraries/css/RadiobuttonCss.css">
    <link rel="stylesheet" type="text/css" href="./libraries/css/CheckboxCss.css"> -->

    <style>
        button {
            color: black;
            /* This is a single-line comment */
            text-align: center;
        }

        p {
            color: blue;
            /* This is a single-line comment */
            text-align: center;
        }

        h1,
        h2 {
            color: black;
            /* This is a single-line comment */
            font-size: 14px;
            text-align: center;
        }

        div {
            background-color: #0ff;
            /* background-color: black; */
            color: #e7e7e7;
            font: lighter;
            width: flex;
            height: 40px;
            border: 1px dotted whitesmoke;
            overflow: auto;
        }

        .notification {
            background-color: rgba(5, 41, 48, 0.507);
            height: 20px;
        }

        .xJSON {
            background-color: rgba(57, 104, 13, 0.507);
            height: 50px;
        }

        .label {
            color: white;
            padding: 8px;
            font-family: Arial;
        }

        .success {
            background-color: #4CAF50;
        }

        /* Green */
        .info {
            background-color: #2196F3;

        }

        /* Blue */
        .warning {
            background-color: #ff9800;
        }

        /* Orange */
        .danger {
            background-color: #f44336;
        }

        /* Red */
        .other {
            background-color: #e7e7e7;
            color: black;
        }

        /* Gray */

        /* This is
                    a multi-line
                    comment */
    </style>


    <script src="./libraries/webblue-phaseOne.js"></script>
    <script src="./libraries/parseJson.js"></script>
    <script src="./libraries/refreshLayer.js"></script>
    <script>myWindow = null;</script>


    <!-- <script src="./libraries/RGraph.common.core.js"></script>
        <script src="./libraries/RGraph.line.js"></script> -->
    <!-- <script src="./libraries/webblue-phaseOne.js"></script>
        <script src="./libraries/ExtractResult.js"></script>
        <script src="./libraries/ADPCMManager.js"></script>
        <script src="./libraries/ADPCMSync.js"></script>
        <script src="./libraries/BVAudiomanager.js"></script>
        <script src="./libraries/FeatureAudioADPCM.js"></script>
    
        <script>
            deviceNo_1 = new webblue_phaseOne('1');
            deviceNo_2 = new webblue_phaseOne('2');
            deviceNo_3 = new webblue_phaseOne('3');
            deviceNo_4 = new webblue_phaseOne('4');
            deviceNo_BV = new BVAudiomanager('BV');
        </script>
     -->
</head>

<body>
    <h1>Web Bluetooth try</h1>
    <h2>Status</h2>
    <h1>Custom Radio Buttons</h1>

    <table border="1">
        <tr>
            <td>
                <b>Device No.</b>
            </td>
            <td>
                <b>Connected</b>
            </td>
            <td>
                <b>Device Name.</b>
            </td>

            <td>
                <b>Services Discovery Completed</b>
            </td>
            <td>
                <b>Notifications</b>
            </td>
            <!-- <td>
                    <b>Punchmeter Reading</b>
                </td> -->
        </tr>
        <tr>
            <td>1</td>
            <td id="status_connected1">false</td>
            <td id="device_name1">NA</td>
            <td id="status_discovered1">false</td>
            <td id="status_notifications1">false</td>
            <!-- <td id="status_Punchmeter1">false</td> -->

        </tr>
    </table>

    <p>select profile you wanted to connect.</p>
    <p>Take a look at <a href=deviceNo_1.realname target="_blank">device node</a></p>

    <!-- <select id="mySelectedProfile" onchange="if (!(this.value==null)) deviceNo_1 = new webblue_phaseOne(1, this.value)"> -->
    <form>
        <select id="mySelectedProfile" onchange="deviceNo_1 = new webblue_phaseOne(1, this.value)">
            <option value="" selected="selected">Choose a profile</option>
            <option value="BBC_Microbit">Microbit</option>
            <option value="ST_BLUEST">BLUEST</option>
        </select>
        <input type="reset" value="reset" onclick="reinit()" />
    </form>

    <button type="button" onclick="mySelectedProfile()">Display index</button>
    <!-- <button type="button" onclick="deviceNo_1 = undefined">release the object</button> -->

    <div class="xJSON" id="showJson"></div>

    <h2>Device Discovery and Connection</h2>
    <button id="btn_scan1" onclick="deviceNo_1.discoverDevicesOrDisconnect()">discoverDevices</button>
    <hr>
    <div class="notification" id="chardatanotification1"></div>
    <button id="btn_notify1" onclick="deviceNo_1.commitCharActions()">toggle
        Actions Commiting</button><br />
    <hr>
    <h2>option choice</h2>


    <span id="GATTShow">let's start </span>
    <button id="btn_refresh" onclick="myWindow.refreshSelf(deviceNo_1)">Confirm!</button>

    <script>

        function reinit() {
            var options = document.querySelectorAll('#mySelectedProfile option');
            for (var i = 0, l = options.length; i < l; i++) {
                options[i].selected = options[i].defaultSelected;
            }
            // $('#mySelectedProfile').get(0).selectedIndex = 1;
            //not safe and cleared enough if under connection .... TODO ....
            deviceNo_1 = undefined;
            myWindow = null;
            showJson.innerHTML = "";
            GATTShow.innerHTML = "";
            chardatanotification1.innerHTML = "";
        }

        function mySelectedProfile() {
            // var x = document.getElementById("mySelectProfile").selectedIndex;
            // var y = document.getElementById("mySelectProfile").options[x].value;
            // try {(deviceNo_1 == undefined)} { reinit(); return -1; }
            // if (deviceNo_1.realname == "") { reinit(); return -1; }
            try {
                // alert("you'v selected profile : " + deviceNo_1.realname);

                document.getElementsByTagName("a")[0].setAttribute("href", "./libraries/" + deviceNo_1.realname + ".JSON");

                var xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        var myObj = JSON.parse(this.responseText);
                        document.getElementById("showJson").innerHTML = JSON.stringify(myObj);
                        myWindow = new refreshLayer(deviceNo_1.makeObjJson(myObj));
                    }
                };

                // try { xmlhttp.open("GET", "./libraries/" + deviceNo_1.realname + ".txt", true); }
                // catch (error) {
                //     alert('ERROR: ' + error);
                //     console.log('ERROR: ' + error);
                //     reinit();
                //     return -1;
                // }
                xmlhttp.open("GET", "./libraries/" + deviceNo_1.realname + ".JSON", true);
                xmlhttp.send();
                //                     .then(o => { return 1; })
                //                     .catch(error => {
                //                         alert('ERROR: ' + error);
                //                         console.log('ERROR: ' + error);
                //                         reinit();
                //                         return -1;
                //                     });
            }
            catch (error) {
                alert('ERROR: ' + error);
                console.log('ERROR: ' + error);
                reinit();
                return -1;
            }
            // document.getElementById("showJson").innerHTML(obj.name);
            //                 refreshLayers(deviceNo_1.paresedJsonObj);
        }


    </script>

    <script src="./libraries/saveit.js"></script>

    <!-- <script>
        myWindow.checkInputboxHandler(deviceNo_1);
    </script> -->

    <!-- <label class="container" name="hah">One
        <input type="radio" checked="checked" name="radio">
        <span class="checkmark"></span>
    </label>
    <label class="container" name="ww">Two
        <input type="radio" name="radio">
        <span class="checkmark"></span>
    </label>
    <label class="container">Three<input type="radio" name="radio">
        <span class="checkmark"></span>
    </label>

    <label class="container">Four<input type="radio" name="radio">
        <span class="checkmark"></span>
    </label> -->
</body>

</html>